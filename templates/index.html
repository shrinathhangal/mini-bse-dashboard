<!DOCTYPE html>
<html>
<head>
    <title>Mini BSE Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container my-5">
    <h2 class="mb-4">ðŸ“ˆ Mini BSE Dashboard</h2>
    <form method="POST">
        <div class="mb-3">
            <label for="company" class="form-label">Select Company</label>
            <select class="form-select" id="company" name="company" onchange="this.form.submit()">
                {% for c in companies %}
                    <option value="{{ c }}" {% if selected == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>
    </form>

    <div class="card p-3 shadow-sm">
        <h4>{{ selected }} - â‚¹{{ info['currentPrice'] }}</h4>
        <p><strong>Sector:</strong> {{ info.get('sector', 'N/A') }}</p>
        <p><strong>Market Cap:</strong> â‚¹{{ info.get('marketCap', 'N/A') | string }}</p>
        <p><strong>PE Ratio:</strong> {{ info.get('trailingPE', 'N/A') }}</p>
    </div>

    {% if chart_url %}
    <img src="data:image/png;base64,{{ chart_url }}" class="img-fluid my-3" alt="Stock chart">
    {% endif %}

    <div class="mt-4">
        <h5>Last 5 Days</h5>
        <table class="table table-bordered table-sm">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Open</th>
                    <th>Close</th>
                    <th>Volume</th>
                </tr>
            </thead>
            <tbody>
                {% for date, row in hist.iterrows() %}
                <tr>
                    <td>{{ date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ "%.2f"|format(row['Open']) }}</td>
                    <td>{{ "%.2f"|format(row['Close']) }}</td>
                    <td>{{ row['Volume'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="mt-4">
        <h5>ðŸ“° Latest News ({{ selected }})</h5>
        <ul class="list-group">
            {% for n in news %}
                <li class="list-group-item">
                    <a href="{{ n.link }}" target="_blank">{{ n.title }}</a>
                </li>
            {% else %}
                <li class="list-group-item">No news found</li>
            {% endfor %}
        </ul>
    </div>
</div>
</body>
</html>
